    // Save to Apps Script (Final Robust Fix)
    async function saveData() {
      const qtyInput = document.getElementById('qtyInput');
      const totalInput = document.getElementById('totalInput');
      const messageEl = document.getElementById('message');
      
      const qty = qtyInput.value.trim();
      const total = totalInput.value.trim();

      if (!currentRow || isNaN(parseFloat(qty)) || isNaN(parseFloat(total))) {
        // കൃത്യമായ പിശക് സന്ദേശം നൽകുന്നു
        messageEl.textContent = 'Error: Please select an item and ensure QTY/TOTAL are valid numbers.';
        return;
      }

      messageEl.textContent = 'Saving data ...';

      // URL-encoded data ഉപയോഗിക്കുന്നു (CORS പരിഹാരത്തിനായി)
      const formParams = new URLSearchParams({
          row: currentRow,
          qty: parseFloat(qty),
          total: parseFloat(total)
      }).toString();


      try {
        const response = await fetch(WEB_APP_URL, {
          method: 'POST',
          body: formParams // Form Data അയയ്ക്കുന്നു
        });
        
        const result = await response.json();

        if (result.status === 'success') {
          messageEl.textContent = 'Successfully Saved Data!';
          // Reset fields
          qtyInput.value = '';
          totalInput.value = '';
          document.getElementById('searchInput').value = '';
          document.getElementById('saveButton').disabled = true;
          document.getElementById('resultDisplay').style.display = 'none';
          currentRow = null;
          selectedItem = null;
        } else {
          // Apps Script-ൽ നിന്നുള്ള യഥാർത്ഥ പിശക് സന്ദേശം കാണിക്കുന്നു
          messageEl.textContent = `Save Error: ${result.message || 'Unknown AppScript error'}`;
        }
      } catch (e) {
        console.error(e);
        messageEl.textContent = 'An error occurred while saving data. Check network/AppScript URL.';
      }
    }
