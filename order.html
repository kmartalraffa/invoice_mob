<script>
    const MAIN_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQfKOLigH7-3yCD2FNxvZNYDcoj97Gl0tqqsgHKIAWLAZpZp4sKzQ_s5w2QpjfZ638M-y4z-c79M3t/pub?gid=446680044&single=true&output=csv";
    const OFFER_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQfKOLigH7-3yCD2FNxvZNYDcoj97Gl0tqqsgHKIAWLAZpZp4sKzQ_s5w2QpjfZ638M-y4z-c79M3t/pub?gid=806396571&single=true&output=csv";
    
    let items = [], offerItems = {}, selected = null, isOfferDay = false;

    function parseDate(dateStr) {
        if(!dateStr) return null;
        if(dateStr.includes('/')) {
            const parts = dateStr.split('/');
            return new Date(parts[2], parts[1]-1, parts[0]);
        }
        return new Date(dateStr);
    }

    async function fetchOffers() {
        try {
            const res = await fetch(OFFER_CSV + "&t=" + new Date().getTime());
            const data = await res.text();
            const rows = data.split('\n');
            if(rows.length > 0) {
                const dates = rows[0].split(',');
                const start = parseDate(dates[0]);
                const end = parseDate(dates[1]);
                const today = new Date(); today.setHours(0,0,0,0);
                isOfferDay = start && end && (today >= start && today <= end);
                rows.slice(1).forEach(r => {
                    const c = r.split(',');
                    if(c[0]) offerItems[c[0].trim()] = parseFloat(c[1]);
                });
            }
        } catch (e) { console.log("Offer Error"); }
    }
    // ... (rest of invoice logic) ...
</script>
